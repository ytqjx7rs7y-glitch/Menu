<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø³Ø¬Ù„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± </title>

<!-- ğŸ›‘ Ø¥Ø¶Ø§ÙØ© Ù…ÙƒØªØ¨Ø§Øª Firebase Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ© (App Ùˆ Firestore) -->
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>

<style>
/* ØªÙ†Ø³ÙŠÙ‚Ø§Øª CSS Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø¬Ù„ */
body {
    font-family: sans-serif;
    background: #fafafa;
    padding: 20px;
    max-width: 600px;
    margin: 0 auto;
}
h1 {
    text-align: center;
    color: #333;
}
.invoice {
    background: white;
    padding: 15px;
    margin-bottom: 20px;
    border-radius: 8px;
    border: 1px solid #ddd;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}
h2 {
    margin: 0;
    font-size: 1.1em;
    padding-bottom: 5px;
    border-bottom: 1px dashed #ccc;
    margin-bottom: 10px;
}
.item {
    margin: 5px 0;
    font-size: 0.9em;
}
.total {
    margin-top: 15px;
    font-weight: bold;
    color: #d63333;
    font-size: 1.2em;
    border-top: 1px solid #eee;
    padding-top: 5px;
}
.actions {
    text-align: center;
    margin-top: 25px;
    margin-bottom: 25px;
}
.actions button {
    padding: 10px 20px;
    margin: 5px;
    font-size: 16px;
    border-radius: 5px;
    cursor: pointer;
    border: none;
    color: white;
    transition: background-color 0.3s;
}
#backBtn {
    background: #4CAF50;
}
#backBtn:hover {
    background-color: #45a049;
}

    .order-header {
    display: flex;
    justify-content: space-between; /* Ù„ÙØµÙ„ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ø¹Ù„Ù‰ Ø·Ø±ÙÙŠ Ø§Ù„Ø³Ø·Ø± */
    font-weight: bold;
    margin-bottom: 5px;
}
</style>
</head>

<body>

<h1>Ø³Ø¬Ù„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ</h1>

<div class="actions">
    <button id="backBtn" onclick="location.href='index.html'">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù†ÙŠÙˆ</button>
    <button onclick="loadInvoices()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„</button>
</div>

<div id="invoices">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±...</div>

<script>
// ğŸ›‘ ØªÙ‡ÙŠØ¦Ø© Firebase Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙØ§ØªÙŠØ­Ùƒ Ø§Ù„Ø®Ø§ØµØ© (Ù†ÙØ³ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ ÙÙŠ index.html)
const firebaseConfig = {
  apiKey: "AIzaSyB94M3Flt9fPYKUuM0DdsE4FvvyJk6MrfA",
  authDomain: "menu-9d12b.firebaseapp.com",
  projectId: "menu-9d12b",
  storageBucket: "menu-9d12b.firebasestorage.app",
  messagingSenderId: "1076348478164",
  appId: "1:1076348478164:web:5b3984659930c771401141",
  measurementId: "G-H90HNXQ9P1"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªÙ†Ø³ÙŠÙ‚ ÙƒØ§Ø¦Ù† Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØ±Ø¬Ø¹ Ù…Ù† Firebase
function formatInvoiceDate(timestamp) {
    if (!timestamp || !timestamp.toDate) return 'Ø§Ù„ØªØ§Ø±ÙŠØ® ØºÙŠØ± Ù…ØªÙˆÙØ±';
    try {
        const dateObj = timestamp.toDate();
        const options = { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric', 
            hour: '2-digit', 
            minute: '2-digit',
            second: '2-digit',
            hour12: true 
        };
        return dateObj.toLocaleDateString('ar-EG', options) + ' ' + dateObj.toLocaleTimeString('ar-EG', options);
    } catch (e) {
        return 'Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„ØªØ§Ø±ÙŠØ®';
    }
}

// Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©
function loadInvoices() {
    let container = document.getElementById("invoices");
    container.innerHTML = "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±...";

    // ğŸ›‘ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù…Ø¬Ù…ÙˆØ¹Ø© "invoices" ÙˆØªØ±ØªÙŠØ¨Ù‡Ø§ Ø­Ø³Ø¨ ÙˆÙ‚Øª Ø§Ù„Ø®Ø§Ø¯Ù… (Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)
    db.collection("invoices").orderBy("timestamp", "desc").get()
        .then((querySnapshot) => {
            let htmlContent = '';
            
            if (querySnapshot.empty) {
                container.innerHTML = "<p style='text-align: center; margin-top: 40px; color: #666;'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</p>";
                return;
            }

            querySnapshot.forEach((doc) => {
                const inv = doc.data();
                // Ø¹Ø±Ø¶ ÙˆÙ‚Øª Ø§Ù„Ø®Ø§Ø¯Ù…
                const formattedDate = formatInvoiceDate(inv.timestamp); 

                htmlContent += `
                    <div class="invoice">
    <!-- ğŸ›‘ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ø°ÙŠ ÙŠØ¶ÙŠÙ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® -->
    <div class="order-header">
        <h2>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: ${inv.orderNumber || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</h2>
        <span>${formattedDate}</span>
    </div>
    <hr style="border: 0; border-top: 1px solid #eee; margin: 10px 0;">
    ${inv.items.map(i => `
        <div class="item">${i.name} â€” Ø§Ù„ÙƒÙ…ÙŠØ©: ${i.qty} | Ø§Ù„Ø³Ø¹Ø±: ${i.price} Ø±ÙŠØ§Ù„</div>
    `).join("")}
    <div class="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ: ${inv.total} Ø±ÙŠØ§Ù„</div>
</div>

`;
            });

            container.innerHTML = htmlContent;
        })
        .catch((error) => {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ù…Ù† Firebase: ", error);
            container.innerHTML = "<p style='text-align: center; color: red;'>ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±. ØªØ£ÙƒØ¯ÙŠ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆÙ‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£Ù…Ø§Ù†.</p>";
        });
}
    
// Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©ØŒ Ø§Ø¨Ø¯Ø£ Ø¨ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
window.onload = loadInvoices;
</script>

</body>
</html>
